# 🧠 Scheme 中的 `cons`、pair 与列表结构  

---

## 🌱 1. 基础概念：`cons` 的作用

`cons` 是 Scheme 中最基础的构造函数，用于**构造一个 pair（对）**。

```scheme
(cons a b)
```

它创建一个包含两个部分的“盒子”结构：

```
+---+---+
| a | b |
+---+---+
```

- **car**：表示第一个槽（a）  
- **cdr**：表示第二个槽（b）

---

## 🧩 2. 列表的构成：由一连串 pair 组成

一个 Scheme 列表 `(1 2 3)` 实际上是多个 `cons` 嵌套构成的：

```scheme
(cons 1 (cons 2 (cons 3 nil)))
```

相当于：
```
+---+---+    +---+---+    +---+---+
| 1 | o----> | 2 | o----> | 3 | / |
+---+---+    +---+---+    +---+---+
```

- 最后一个 `cdr` 为 `nil`，表示列表的**结束**
- 整个结构是一个**链表（linked list）**

---

## 🧠 3. 当 `cdr` 不是列表时会发生什么？

### ⚠️ 1️⃣ `cdr` 不是 `nil` 或列表

如果 `b`（即第二个参数）不是 `nil` 或一个列表，结果就不是纯列表，而是一个普通的 **pair**。

```scheme
(cons 1 2)
```

输出：
```
(1 . 2)
```

- 这里的点号 `.` 表示一个 **一般的 pair**
- 结构图：

```
+---+---+
| 1 | 2 |
+---+---+
```

---

### ⚙️ 2️⃣ 嵌套的 pair 结构

```scheme
(cons (cons 1 2) 3)
```

输出：
```
((1 . 2) . 3)
```

结构图：

```
+---+---+
| o | 3 |
+-|-+---+
  |
  v
+---+---+
| 1 | 2 |
+---+---+
```

说明：
- `car` 部分本身又是一个 pair
- 这就是**嵌套的 pair 结构（nested pairs）**

---

## ✅ 4. 纯列表的条件

一个结构要成为真正的列表，必须满足：

> **每个 `cons` 的 `cdr` 都指向另一个列表或 `nil`。**

| 表达式 | 输出 | 是否为列表 | 说明 |
|:---------|:----------|:-----------|:-------------|
| `(cons 1 (cons 2 nil))` | `(1 2)` | ✅ 是 | 每个 cdr 都是列表 |
| `(cons 1 2)` | `(1 . 2)` | ❌ 否 | cdr 不是列表 |
| `(cons (cons 1 2) 3)` | `((1 . 2) . 3)` | ❌ 否 | cdr 是原子值 |
| `(cons (cons 1 2) (cons 3 nil))` | `((1 . 2) 3)` | ✅ 是 | 嵌套结构但仍为列表 |

---

## 🧾 5. `car` 与 `cdr` 操作

可以使用 `car` 和 `cdr` 访问 pair 的内容：

```scheme
(define x (cons 1 (cons 2 nil)))
(car x) ; 输出: 1
(cdr x) ; 输出: (2)
```

- **`car`** 取出第一个元素
- **`cdr`** 取出“剩下的列表”

---

## 📦 6. 复杂嵌套结构举例

```scheme
(define x (cons 1 (cons 2 (cons 3 (cons 4 nil)))))
```

输出：
```
(1 2 3 4)
```

相当于 Python 中的嵌套结构：
```python
(1, (2, (3, (4, None))))
```

- 实际上就是一个 **链表结构**。
- 每个 `cons` 连接到下一个 `cons`，直到遇到 `nil`。

---

## 🧭 7. 显示形式（Scheme 的自动格式化）

```scheme
(1 2 3 4)
```

等价于：
```scheme
(cons 1 (cons 2 (cons 3 (cons 4 nil))))
```

Scheme 会**自动省略**括号与 `nil`，以简洁的形式显示完整的链表结构。

---

## 🔍 8. 核心理解总结

| 概念 | 说明 |
|:------|:------|
| **`cons`** | 创建一个 pair（a . b） |
| **pair** | 一个包含两个槽（car 与 cdr）的数据结构 |
| **list** | 一连串由 `cons` 链接、且 `cdr` 最终为 `nil` 的结构 |
| **非列表 pair** | 若 `cdr` 指向非列表，即为普通 pair |
| **嵌套 pair** | 若 `car` 或 `cdr` 含另一个 pair，形成嵌套结构 |

---

## 🧭 9. 思维导图记忆

```
cons
 ├── 基本作用：创建 (a . b)
 ├── 若 b 是列表 → 构成链表结构
 ├── 若 b 不是列表 → 一般 pair
 ├── 若嵌套 → 嵌套 pair
 └── 纯列表条件：所有 cdr → 列表 或 nil
```

---

## 🧩 10. 小结

- **`cons`** 是一切列表结构的基础。  
- **列表** 只是由特殊形态的 pair 构成的链表。  
- 若任何 `cdr` 不是 `nil` 或列表，结构就断裂为“嵌套 pair”。  
- 理解 `cons` 的语义，就能理解 Scheme 的一切复杂数据结构。
