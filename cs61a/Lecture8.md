Berkeley CS Lecture Notes: Understanding Python Print and Function Behavior

è¿™é¡µPPTçš„ä¸»è¦å†…å®¹å›´ç»• Python print å‡½æ•°çš„è¿”å›å€¼ ä»¥åŠ åµŒå¥—å‡½æ•° (nested functions) çš„ä½œç”¨ã€‚
â¸»

1. print å‡½æ•°çš„è¿”å›å€¼

åœ¨ Python ä¸­ï¼Œprint å‡½æ•°çš„ä½œç”¨æ˜¯ åœ¨ç»ˆç«¯è¾“å‡ºå†…å®¹ï¼Œä½†å®ƒçš„ è¿”å›å€¼å§‹ç»ˆæ˜¯ Noneã€‚è¿™ç‚¹åœ¨ä»¥ä¸‹ä¾‹å­ä¸­ä½“ç°ï¼š

è¡¨è¾¾å¼	    è®¡ç®—ç»“æœ	äº¤äº’å¼è¾“å‡º
5	          5	         5
print(5)    None	     5
print(print(5))	None	5ï¼ŒNone

é‡ç‚¹ç†è§£
	â€¢	ç›´æ¥å†™ 5ï¼ŒPython è§£é‡Šå™¨ä¼šè¿”å› 5ã€‚
	â€¢	print(5) ä¼šæ‰“å° 5ï¼Œä½†å®ƒçš„è¿”å›å€¼æ˜¯ Noneã€‚
	â€¢	print(print(5)) çš„å†…éƒ¨æ‰§è¡Œè¿‡ç¨‹ï¼š
	1.	print(5) å…ˆæ‰§è¡Œï¼Œè¾“å‡º 5ï¼Œå¹¶è¿”å› Noneã€‚
	2.	print(None) æ‰§è¡Œï¼Œè¾“å‡º Noneã€‚

â¸»

2. Python é«˜é˜¶å‡½æ•°ï¼šåµŒå¥—å‡½æ•°

PPT ä¸­å®šä¹‰äº†ä¸€ä¸ªç‰¹æ®Šçš„ delay å‡½æ•°ï¼š

def delay(arg):
    print("delayed")
    def g():
        return arg
    return g

	â€¢	delay(arg) æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ª æ–°çš„å‡½æ•° gã€‚
	â€¢	g() ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œåªæœ‰å½“ g() è¢«è°ƒç”¨æ—¶ï¼Œæ‰ä¼šè¿”å› argã€‚

å¤æ‚è¡¨è¾¾å¼è§£æ

è¡¨è¾¾å¼ delay(delay)()(6)

æ­¥éª¤	                ç»“æœ
delay(delay)	       æ‰“å° â€œdelayedâ€ï¼Œè¿”å› g()
delay(delay)()	       è°ƒç”¨ g()ï¼Œè¿”å› delay
delay(delay)()(6)	   æ‰§è¡Œ delay(6)ï¼Œæ‰“å° â€œdelayedâ€ï¼Œè¿”å› g()
delay(delay)()(6)()	   è°ƒç”¨ g()ï¼Œè¿”å› 6

æœ€ç»ˆçš„äº¤äº’å¼è¾“å‡º

delayed
delayed
6



â¸»

1. å¤æ‚å‡½æ•°è°ƒç”¨æ¡ˆä¾‹

print(delay(print)()(4))

æ­¥éª¤	             ç»“æœ
delay(print)	    æ‰“å° â€œdelayedâ€ï¼Œè¿”å› g()
delay(print)()(4)	æ‰§è¡Œ g()ï¼Œè¿”å› print
print(4)	        è¾“å‡º 4ï¼Œè¿”å› None

æœ€ç»ˆçš„äº¤äº’å¼è¾“å‡º

delayed
4
None



â¸»

4. é‡ç‚¹çŸ¥è¯†ç‚¹æ€»ç»“

(1) print çš„è¿”å›å€¼
	â€¢	print() ä»…ä»…æ˜¯ è¾“å‡ºï¼Œä½† è¿”å›å€¼å§‹ç»ˆæ˜¯ Noneã€‚

(2) é«˜é˜¶å‡½æ•°å’ŒåµŒå¥—ä½œç”¨åŸŸ
	â€¢	Python å‡½æ•°å¯ä»¥è¿”å›å¦ä¸€ä¸ªå‡½æ•°ï¼Œå½¢æˆ é—­åŒ…ï¼ˆclosureï¼‰ã€‚
	â€¢	è°ƒç”¨ delay(arg) å¹¶ä¸ä¼šç«‹å³è¿”å› argï¼Œè€Œæ˜¯è¿”å› g()ï¼Œéœ€è¦ g() è¢«è°ƒç”¨åæ‰ä¼šè¿”å› argã€‚

(3) å‡½æ•°æ‰§è¡Œé¡ºåº
	â€¢	éœ€è¦æŒ‰ç…§ ä»å†…åˆ°å¤– çš„æ‰§è¡Œé€»è¾‘åˆ†æ Python ä»£ç ã€‚
	â€¢	å…³æ³¨ å‡½æ•°è¿”å›å€¼ï¼Œä¸è¦è¢« print è¯­å¥çš„è¾“å‡ºå¹²æ‰°ã€‚

â¸»

å¦‚ä½•æé«˜ Python ä»£ç ç†è§£èƒ½åŠ›ï¼Ÿ
	1.	å¤šåšåˆ†è§£ç»ƒä¹ ï¼šåœ¨çº¸ä¸Šæ‰‹å†™ æ¯ä¸€æ­¥çš„æ‰§è¡Œé¡ºåºï¼Œé¿å…ç›²ç›®æ‰§è¡Œä»£ç ã€‚
	2.	ä½¿ç”¨ print(type(x)) è¾…åŠ©ç†è§£ï¼šæ£€æŸ¥è¿”å›å€¼çš„æ•°æ®ç±»å‹ï¼Œé¿å…è¯¯è§£ä»£ç è¡Œä¸ºã€‚
	3.	åœ¨ Python è§£é‡Šå™¨ä¸­è°ƒè¯•ï¼šä½¿ç”¨ Python Tutorï¼ˆhttp://pythontutor.com/ï¼‰å¯è§†åŒ–ä»£ç æ‰§è¡Œè¿‡ç¨‹ã€‚
	4.	å¤šåšé«˜é˜¶å‡½æ•°ç»ƒä¹ ï¼šPython çš„ lambdaã€mapã€filter ä¹Ÿæ˜¯åŸºäºç±»ä¼¼æ¦‚å¿µæ„å»ºçš„ã€‚


***è§£æ delay(delay)()(6)() çš„æ‰§è¡Œè¿‡ç¨‹

æˆ‘ä»¬å…ˆå›é¡¾ delay å‡½æ•°çš„å®šä¹‰ï¼š

def delay(arg):
    print("delayed")
    def g():
        return arg
    return g

è¯¥å‡½æ•°çš„æ‰§è¡Œé€»è¾‘æ˜¯ï¼š
	1.	è°ƒç”¨ delay(arg) ä¼š æ‰“å° "delayed"ï¼Œç„¶åè¿”å› å†…éƒ¨å‡½æ•° g()ã€‚
	2.	g() è¢«è°ƒç”¨æ—¶ï¼Œä¼š è¿”å› argã€‚

â¸»

æ‰§è¡Œ delay(delay)()(6)()

æˆ‘ä»¬æ‹†è§£ delay(delay)()(6)() çš„æ‰§è¡Œè¿‡ç¨‹ï¼š

ç¬¬ 1 æ­¥ï¼šdelay(delay)
	â€¢	delay å‡½æ•°è¢«è°ƒç”¨ï¼Œå‚æ•° arg æ˜¯ delay æœ¬èº«ã€‚
	â€¢	print("delayed") è¾“å‡º "delayed"ã€‚
	â€¢	è¿”å› g()ï¼Œå…¶ä¸­ g() æ˜¯ï¼š

def g():
    return delay



âœ… å½“å‰è¿”å›çš„å€¼æ˜¯ g()ï¼Œå®ƒç­‰ä»·äºä¸€ä¸ª return delay çš„å‡½æ•°ã€‚

â¸»

ç¬¬ 2 æ­¥ï¼šdelay(delay)()
	â€¢	delay(delay) è¿”å›äº† g()ï¼Œæ‰€ä»¥ delay(delay)() è°ƒç”¨ g()ã€‚
	â€¢	g() çš„å®šä¹‰æ˜¯ return delayï¼Œæ‰€ä»¥å®ƒè¿”å› delayã€‚

âœ… å½“å‰è¿”å›çš„å€¼æ˜¯ delay å‡½æ•°æœ¬èº«ã€‚

â¸»

ç¬¬ 3 æ­¥ï¼šdelay(delay)()(6)
	â€¢	ä¸Šä¸€æ­¥è¿”å› delayï¼Œæ‰€ä»¥ delay(delay)()(6) ç­‰ä»·äº delay(6)ã€‚
	â€¢	delay(6) è¢«è°ƒç”¨ï¼Œarg=6ã€‚
	â€¢	print("delayed") è¾“å‡º "delayed"ã€‚
	â€¢	è¿”å› g()ï¼Œå…¶ä¸­ g() æ˜¯ï¼š

def g():
    return 6



âœ… å½“å‰è¿”å›çš„å€¼æ˜¯ g()ï¼Œå®ƒç­‰ä»·äº return 6 çš„å‡½æ•°ã€‚

â¸»

ç¬¬ 4 æ­¥ï¼šdelay(delay)()(6)()
	â€¢	ä¸Šä¸€æ­¥è¿”å› g()ï¼Œæ‰€ä»¥ delay(delay)()(6)() è°ƒç”¨ g()ã€‚
	â€¢	g() çš„å®šä¹‰æ˜¯ return 6ï¼Œæ‰€ä»¥å®ƒè¿”å› 6ã€‚

âœ… æœ€ç»ˆè¿”å› 6ã€‚

â¸»

å®Œæ•´çš„è¾“å‡º

delay(delay)()(6)()

çš„æ‰§è¡Œé¡ºåºå’Œè¾“å‡ºï¼š

delayed
delayed
6

ä½ å¯ä»¥æŠŠ delay æƒ³è±¡æˆä¸€ä¸ªâ€œå»¶è¿Ÿè¿”å›â€çš„æœºåˆ¶ï¼Œæ¯æ¬¡è°ƒç”¨å®ƒï¼Œéƒ½ä¼šè¿”å› ä¸€ä¸ªå‡½æ•°ï¼Œç›´åˆ°æœ€ç»ˆçš„ g() è¢«è°ƒç”¨æ—¶ï¼Œæ‰çœŸæ­£è¿”å› arg çš„å€¼ã€‚


è¿™é¡µ PPT ä¸»è¦è€ƒå¯Ÿ Python ä½œç”¨åŸŸä¸é«˜é˜¶å‡½æ•°çš„æ‰§è¡Œé¡ºåºï¼Œæ¶‰åŠä»¥ä¸‹å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼š

1. Python çš„å‡½æ•°è°ƒç”¨ä¸è¿”å›å€¼
	â€¢	square(x): è®¡ç®— x * x
	â€¢	pirate(arggg):
	â€¢	print("matey") ç›´æ¥è¾“å‡º "Matey"
	â€¢	plunder(arggg): è¿”å› arggg
	â€¢	pirate(x) æ€»æ˜¯è¿”å› identity functionï¼ˆæ’ç­‰å‡½æ•°ï¼‰

2. ä»£ç è§£æ
	â€¢	add(pirate(3)(square)(4), 1)
	1.	pirate(3) æ‰§è¡Œï¼Œæ‰“å° "Matey"ï¼Œè¿”å› identity function
	2.	identity function(square) ä»ç„¶è¿”å› square
	3.	square(4) è®¡ç®— 16
	4.	add(16, 1) è®¡ç®— 17
	5.	è¾“å‡ºï¼šâ€œMateyâ€ 17
	â€¢	pirate(pirate(pirate))(5)(7)
	1.	pirate(pirate) æ‰§è¡Œï¼Œæ‰“å° "Matey"ï¼Œè¿”å› identity function
	2.	pirate(identity function) æ‰§è¡Œï¼Œæ‰“å° "Matey"ï¼Œè¿”å› identity function
	3.	identity function(5) è¿”å› 5
	4.	5(7) ä¼å›¾è°ƒç”¨ 5ï¼Œå‘ç”Ÿé”™è¯¯
	5.	è¾“å‡ºï¼šâ€œMateyâ€ â€œMateyâ€ Error

3. çŸ¥è¯†ç‚¹æ€»ç»“
	â€¢	Python ä½œç”¨åŸŸï¼špirate å®šä¹‰äº†ä¸€ä¸ªåµŒå¥—å‡½æ•° plunderï¼Œè¿”å› argggï¼Œæœ¬è´¨ä¸Šæ˜¯æ’ç­‰å‡½æ•°
	â€¢	é«˜é˜¶å‡½æ•°ï¼špirate(x) è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’
	â€¢	å‡½æ•°è°ƒç”¨é¡ºåºï¼šå¤–å±‚å‡½æ•° pirate å…ˆæ‰§è¡Œå¹¶æ‰“å° "Matey"ï¼Œå†è¿”å›å‡½æ•°
	â€¢	é”™è¯¯è§£æï¼šå°è¯• 5(7) å¯¼è‡´é”™è¯¯

4. æé«˜æˆç»©çš„å»ºè®®
	â€¢	å¤šç»ƒä¹  Python ä½œç”¨åŸŸä¸é«˜é˜¶å‡½æ•°
	â€¢	ç†è§£ è¿”å›å€¼æ˜¯å‡½æ•°çš„æ¦‚å¿µ
	â€¢	ç”»å‡º è°ƒç”¨è¿‡ç¨‹å›¾ï¼Œåˆ†ææ‰§è¡Œé¡ºåº


ä»€ä¹ˆæ˜¯ Identity Functionï¼ˆæ’ç­‰å‡½æ•°ï¼‰ï¼Ÿ

Identity Functionï¼ˆæ’ç­‰å‡½æ•°ï¼‰ æ˜¯ä¸€ä¸ªè¿”å›å…¶è¾“å…¥å‚æ•°çš„å‡½æ•°ï¼Œå³ï¼š

def identity(x):
    return x

æ¢å¥è¯è¯´ï¼Œæ— è®ºä¼ å…¥ä»€ä¹ˆå‚æ•°ï¼Œå®ƒéƒ½ä¼š åŸæ ·è¿”å›ã€‚

â¸»

identity function æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿ

åœ¨ pirate å‡½æ•°ä¸­ï¼Œå®ƒçš„è¡Œä¸ºå¦‚ä¸‹ï¼š

def pirate(arggg):
    print("matey")
    def plunder(arggg):
        return arggg  # è¿™é‡Œè¿”å›ä¼ å…¥çš„å‚æ•°ï¼Œå³ identity function çš„ç‰¹æ€§
    return plunder

	â€¢	pirate(arggg) æ‰§è¡Œåï¼Œå®ƒè¿”å› plunder è¿™ä¸ªå‡½æ•°ã€‚
	â€¢	plunder(arggg) çš„å®šä¹‰æ˜¯ return argggï¼Œæ„å‘³ç€ plunder åªä¼šè¿”å›å®ƒçš„è¾“å…¥å‚æ•°ï¼Œä¸åšä»»ä½•ä¿®æ”¹ã€‚
	â€¢	è¿™æ­£æ˜¯ identity functionï¼ˆæ’ç­‰å‡½æ•°ï¼‰çš„è¡Œä¸ºï¼Œæ‰€ä»¥ pirate(x) ç›¸å½“äº identity functionã€‚

â¸»

ä»£ç è§£æï¼ˆå¦‚ä½•äº§ç”Ÿ identity functionï¼‰

ä¾‹å­ï¼š

f = pirate(3)  # æ‰§è¡Œ pirate(3)ï¼Œæ‰“å° "Matey"ï¼Œè¿”å› plunder å‡½æ•°
print(f(10))   # f(10) ç›¸å½“äº plunder(10)ï¼Œæ‰€ä»¥è¿”å› 10

æ‰§è¡Œé¡ºåºï¼š
	1.	pirate(3) æ‰§è¡Œï¼Œæ‰“å° "Matey"ï¼Œè¿”å› plunder
	2.	f(10) å®é™…ä¸Šæ˜¯ plunder(10)ï¼Œè¿”å› 10
	3.	æ‰€ä»¥ f(10) çš„ä½œç”¨å°±å’Œ identity function ä¸€æ ·ï¼

â¸»

åœ¨é¢˜ç›®ä¸­çš„ä½œç”¨

åœ¨ pirate(pirate(pirate))(5)(7) é‡Œï¼š
	1.	pirate(pirate) æ‰§è¡Œï¼š
	â€¢	æ‰“å° "Matey"
	â€¢	è¿”å› identity function
	2.	pirate(identity function) æ‰§è¡Œï¼š
	â€¢	æ‰“å° "Matey"
	â€¢	è¿”å› identity function
	3.	identity function(5) æ‰§è¡Œï¼š
	â€¢	è¿”å› 5
	4.	é”™è¯¯å‘ç”Ÿåœ¨ 5(7)ï¼Œå› ä¸º 5 ä¸æ˜¯å‡½æ•°ï¼

â¸»

æ€»ç»“
	â€¢	pirate(x) ä¸æ˜¯ç›´æ¥è¿”å› xï¼Œè€Œæ˜¯è¿”å› plunder è¿™ä¸ª identity functionã€‚
	â€¢	identity function æœ¬è´¨ä¸Šæ˜¯ lambda x: xï¼Œå³è¿”å›è‡ªèº«è¾“å…¥çš„å‡½æ•°ã€‚
	â€¢	åœ¨ pirate(pirate(pirate))(5)(7) ä¸­ï¼Œç»è¿‡ä¸¤æ¬¡ pirate è°ƒç”¨åï¼Œæœ€ç»ˆå¾—åˆ° identity functionï¼Œç„¶å identity function(5) è¿”å› 5ï¼Œå¯¼è‡´ 5(7) æ—¶æŠ¥é”™ã€‚



*******

ä»£ç å›é¡¾

def horse(mask):
    horse = mask
    def mask(horse):
        return horse(2)
    return horse(mask)

mask = lambda horse: horse(2)
horse(mask)



â¸»

æ‰§è¡Œæµç¨‹è¯¦è§£

Python åœ¨æ‰§è¡Œ horse(mask) æ—¶ï¼Œä¼šæŒ‰ç…§ ç¯å¢ƒæ¨¡å‹ï¼ˆEnvironment Modelï¼‰ é€æ­¥åˆ›å»ºæ–°çš„ä½œç”¨åŸŸï¼Œå¹¶è·Ÿè¸ªå˜é‡ç»‘å®šå…³ç³»ã€‚

â¸»

1. å…¨å±€ä½œç”¨åŸŸï¼ˆGlobal Frameï¼‰

def horse(mask):  # horse å‡½æ•°å®šä¹‰
    ...
mask = lambda horse: horse(2)  # mask èµ‹å€¼
horse(mask)  # å‡½æ•°è°ƒç”¨

	â€¢	å˜é‡ï¼š
	â€¢	horse â†’ func horse(mask) [parent=Global]
	â€¢	mask â†’ Î» horse: horse(2) [parent=Global]

è°ƒç”¨ horse(mask) è¿›å…¥ f1ï¼ˆFrame 1ï¼‰ã€‚

â¸»

2. f1: horse(mask) æ‰§è¡Œ

def horse(mask):
    horse = mask  # horse ç»‘å®šä¸ºä¼ å…¥çš„ maskï¼Œå³ lambda horse: horse(2)
    def mask(horse):
        return horse(2)
    return horse(mask)

	â€¢	å˜é‡ï¼š
	â€¢	horse = Î» horse: horse(2)
	â€¢	mask = func mask(horse) [parent=f1]

æ‰§è¡Œï¼š

return horse(mask)

	â€¢	horse ç°åœ¨æ˜¯ lambda horse: horse(2)
	â€¢	è®¡ç®— horse(mask)ï¼š

(lambda horse: horse(2))(mask)

	â€¢	horse = maskï¼Œæ‰€ä»¥æ‰§è¡Œ mask(2)

è¿›å…¥ f2ï¼ˆFrame 2ï¼‰ã€‚

â¸»

3. f2: mask(2) æ‰§è¡Œ
	â€¢	mask ç°åœ¨æ˜¯ï¼š

def mask(horse):
    return horse(2)

	â€¢	mask åœ¨ f1 ä½œç”¨åŸŸå†…å®šä¹‰ï¼Œparent=f1
	â€¢	è¿™é‡Œ horse = 2
	â€¢	è®¡ç®— horse(2)

æ‰€ä»¥ï¼š

return 2

æœ€ç»ˆè¿”å› 2ï¼Œä¸ä¼šæŠ¥é”™ã€‚

â¸»

æœ€ç»ˆç»“æœ

ğŸ”¹ horse(mask) â†’ mask(2) â†’ 2
âœ… æœ€ç»ˆçš„è¿”å›å€¼æ˜¯ 2ï¼Œä»£ç ä¸ä¼šæŠ¥é”™ï¼

â¸»

æ€»ç»“
	1.	é”™è¯¯ç†è§£ä¿®æ­£ï¼šåŸæœ¬ä»¥ä¸º horse(2) ä¼šè°ƒç”¨æ•´æ•° 2ï¼Œä½†å®é™…ä¸Š horse åœ¨ f2 ä½œç”¨åŸŸå†…æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ˆmaskï¼‰ï¼Œæ‰€ä»¥æ‰§è¡Œæ­£å¸¸ã€‚
	2.	ä½œç”¨åŸŸè§£æï¼š
	â€¢	horse = mask
	â€¢	mask(2) å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ def mask(horse)ï¼Œè€Œ horse åœ¨ mask(horse) å†…éƒ¨åªæ˜¯ä¸€ä¸ªå‚æ•°ï¼Œå¹¶ä¸ä¼šå½±å“å¤–å±‚ horse çš„ç»‘å®šã€‚
	3.	Python çš„ç¯å¢ƒæ¨¡å‹ï¼ˆEnvironment Modelï¼‰ï¼š
	â€¢	å˜é‡æŸ¥æ‰¾éµå¾ª æœ€è¿‘ä½œç”¨åŸŸåŸåˆ™ï¼ˆLexical Scopingï¼‰ã€‚
	â€¢	horse å˜é‡åœ¨ä¸åŒä½œç”¨åŸŸå†…æŒ‡å‘ä¸åŒçš„å¯¹è±¡ï¼Œæ‰§è¡Œæ—¶è¦çœ‹ å½“å‰ç¯å¢ƒã€‚
	


******è£…é¥°å™¨*****

1. ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼Ÿ

è£…é¥°å™¨æ˜¯Python ä¸­çš„ä¸€ç§ç‰¹æ®Šå‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼š
âœ… ç»™å·²æœ‰çš„å‡½æ•°æˆ–æ–¹æ³•å¢åŠ é¢å¤–çš„åŠŸèƒ½ï¼Œè€Œä¸ä¿®æ”¹åŸæ¥çš„ä»£ç ã€‚

å¯ä»¥æŠŠè£…é¥°å™¨æƒ³è±¡æˆï¼š
ğŸ­ ç»™å‡½æ•°æˆ´ä¸Šä¸€ä¸ªâ€œé¢å…·â€ï¼Œè¿™ä¸ªé¢å…·ä¼šå¢å¼ºæˆ–æ”¹å˜å‡½æ•°çš„è¡Œä¸ºï¼Œä½†å‡½æ•°æœ¬èº«ä¿æŒä¸å˜ã€‚

â¸»

2. ä¸ºä»€ä¹ˆè¦ç”¨è£…é¥°å™¨ï¼Ÿ

åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨å¤šä¸ªå‡½æ•°ä¸­æ·»åŠ ç›¸åŒçš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š
	â€¢	æ—¥å¿—è®°å½•ï¼ˆLoggingï¼‰ï¼šè®°å½•å‡½æ•°çš„æ‰§è¡Œæƒ…å†µ
	â€¢	æƒé™æ£€æŸ¥ï¼ˆAuthenticationï¼‰ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®
	â€¢	æ€§èƒ½ç›‘æµ‹ï¼ˆPerformance Monitoringï¼‰ï¼šæµ‹é‡å‡½æ•°è¿è¡Œæ—¶é—´

ä½¿ç”¨è£…é¥°å™¨ï¼Œæˆ‘ä»¬å¯ä»¥é¿å…é‡å¤ä»£ç ï¼Œæé«˜ä»£ç å¤ç”¨æ€§ã€‚

â¸»

3. è£…é¥°å™¨çš„åŸºæœ¬ç”¨æ³•

ğŸ”¹ æ²¡æœ‰è£…é¥°å™¨çš„æƒ…å†µ

å¦‚æœæ²¡æœ‰è£…é¥°å™¨ï¼Œæˆ‘ä»¬å¯èƒ½è¿™æ ·ç»™å‡½æ•°å¢åŠ åŠŸèƒ½ï¼š

def print_log_and_run(func):
    def wrapper():
        print("å¼€å§‹æ‰§è¡Œå‡½æ•°...")
        func()
        print("å‡½æ•°æ‰§è¡Œç»“æŸã€‚")
    return wrapper

def say_hello():
    print("Hello, world!")

# æ‰‹åŠ¨ç»™å‡½æ•°å¢åŠ åŠŸèƒ½
say_hello = print_log_and_run(say_hello)
say_hello()

è¾“å‡ºï¼š

å¼€å§‹æ‰§è¡Œå‡½æ•°...
Hello, world!
å‡½æ•°æ‰§è¡Œç»“æŸã€‚

ğŸ‘‰ é—®é¢˜ï¼šæˆ‘ä»¬æ¯æ¬¡éƒ½è¦æ‰‹åŠ¨ say_hello = print_log_and_run(say_hello)ï¼Œå¾ˆéº»çƒ¦ï¼

â¸»

ğŸ”¹ ä½¿ç”¨ @è£…é¥°å™¨ è¯­æ³•

Python æä¾›äº†ä¸€ç§æ›´ä¼˜é›…çš„æ–¹æ³•ï¼šä½¿ç”¨ @ è¯­æ³•ç³–ï¼

def print_log(func):
    def wrapper():
        print("å¼€å§‹æ‰§è¡Œå‡½æ•°...")
        func()
        print("å‡½æ•°æ‰§è¡Œç»“æŸã€‚")
    return wrapper

@print_log  # è¿™è¡Œç›¸å½“äº say_hello = print_log(say_hello)
def say_hello():
    print("Hello, world!")

say_hello()  # ç›´æ¥è°ƒç”¨

è¾“å‡ºï¼š

å¼€å§‹æ‰§è¡Œå‡½æ•°...
Hello, world!
å‡½æ•°æ‰§è¡Œç»“æŸã€‚

âœ… å¥½å¤„ï¼š
	â€¢	ä¸ç”¨æ‰‹åŠ¨èµ‹å€¼ï¼Œä»£ç æ›´ç®€æ´ï¼
	â€¢	å¤šä¸ªå‡½æ•°å¯ä»¥å¤ç”¨è¿™ä¸ªè£…é¥°å™¨ï¼Œä¸ä¼šå½±å“åŸå§‹å‡½æ•°çš„ä»£ç ã€‚

â¸»

4. é€‚ç”¨äºæœ‰å‚æ•°çš„å‡½æ•°

æœ‰äº›å‡½æ•°æ˜¯å¸¦å‚æ•°çš„ï¼Œæ¯”å¦‚åŠ æ³•å‡½æ•°ï¼š

def print_log(func):
    def wrapper(*args, **kwargs):  # æ¥å—ä»»æ„å‚æ•°
        print(f"å¼€å§‹æ‰§è¡Œ {func.__name__}ï¼Œå‚æ•°æ˜¯ {args}")
        result = func(*args, **kwargs)
        print(f"å‡½æ•° {func.__name__} æ‰§è¡Œç»“æŸï¼Œè¿”å›å€¼æ˜¯ {result}")
        return result
    return wrapper

@print_log
def add(a, b):
    return a + b

print(add(3, 5))

è¾“å‡ºï¼š

å¼€å§‹æ‰§è¡Œ addï¼Œå‚æ•°æ˜¯ (3, 5)
å‡½æ•° add æ‰§è¡Œç»“æŸï¼Œè¿”å›å€¼æ˜¯ 8
8

âœ… å¥½å¤„ï¼š
	â€¢	*args, **kwargs è®©è£…é¥°å™¨èƒ½é€‚ç”¨äºä»»ä½•å‡½æ•°ï¼
	â€¢	é€‚ç”¨äºå¸¦å‚æ•°å’Œæœ‰è¿”å›å€¼çš„å‡½æ•°ã€‚

â¸»

5. è®©è£…é¥°å™¨ä¸æ”¹å˜åŸå‡½æ•°çš„ä¿¡æ¯

æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›å‡½æ•°çš„ __name__ å’Œ __doc__ ä¸è¢«ä¿®æ”¹ï¼š

from functools import wraps

def print_log(func):
    @wraps(func)  # è¿™ä¸ªè£…é¥°å™¨å¯ä»¥ä¿æŒåŸå‡½æ•°çš„ä¿¡æ¯
    def wrapper(*args, **kwargs):
        print(f"å¼€å§‹æ‰§è¡Œ {func.__name__}")
        return func(*args, **kwargs)
    return wrapper

ğŸ“Œ ä½¿ç”¨ @wraps(func) å¯ä»¥ä¿æŒåŸå‡½æ•°çš„ __name__ å’Œ __doc__ã€‚

â¸»

6. å¤šä¸ªè£…é¥°å™¨å åŠ 

Python æ”¯æŒå¤šä¸ªè£…é¥°å™¨ï¼Œæ‰§è¡Œé¡ºåºæ˜¯ä»ä¸Šåˆ°ä¸‹ï¼š

def decor1(func):
    def wrapper():
        print("è£…é¥°å™¨ 1")
        func()
    return wrapper

def decor2(func):
    def wrapper():
        print("è£…é¥°å™¨ 2")
        func()
    return wrapper

@decor1
@decor2
def say_hello():
    print("Hello!")

say_hello()

æ‰§è¡Œé¡ºåºï¼š

è£…é¥°å™¨ 1
è£…é¥°å™¨ 2
Hello!

âœ… æ‰§è¡Œé¡ºåºï¼šdecor1(decor2(say_hello))

â¸»

7. è£…é¥°å™¨çš„å®é™…åº”ç”¨

ï¼ˆ1ï¼‰è®°å½•å‡½æ•°æ‰§è¡Œæ—¶é—´

import time

def timer(func):
    def wrapper(*args, **kwargs):
        start = time.time()
        result = func(*args, **kwargs)
        end = time.time()
        print(f"{func.__name__} è¿è¡Œæ—¶é—´: {end - start:.5f} ç§’")
        return result
    return wrapper

@timer
def slow_function():
    time.sleep(2)
    print("å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼")

slow_function()

è¾“å‡ºï¼š

å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼
slow_function è¿è¡Œæ—¶é—´: 2.00012 ç§’

âœ… ç”¨æ¥æµ‹è¯•å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼

â¸»

ï¼ˆ2ï¼‰æƒé™æ§åˆ¶

def check_permission(func):
    def wrapper(*args, **kwargs):
        user = "admin"
        if user != "admin":
            print("æ— æƒé™æ‰§è¡Œï¼")
            return
        return func(*args, **kwargs)
    return wrapper

@check_permission
def delete_file():
    print("æ–‡ä»¶å·²åˆ é™¤ï¼")

delete_file()

âœ… æ§åˆ¶æŸäº›å‡½æ•°åªèƒ½åœ¨æ»¡è¶³æ¡ä»¶æ—¶è¿è¡Œã€‚

â¸»

8. è¯¾å ‚ç¬”è®°æ€»ç»“

âœ… è£…é¥°å™¨çš„æ ¸å¿ƒæ¦‚å¿µ
	1.	è£…é¥°å™¨æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå¢å¼ºæˆ–ä¿®æ”¹å¦ä¸€ä¸ªå‡½æ•°çš„è¡Œä¸ºã€‚
	2.	è¯­æ³•ï¼šä½¿ç”¨ @è£…é¥°å™¨å ä¿®é¥°å‡½æ•°ï¼Œç­‰åŒäº func = è£…é¥°å™¨(func)ã€‚
	3.	é€‚ç”¨äºå¤šä¸ªå‡½æ•°ï¼Œå¯ä»¥å¤ç”¨ä»£ç ï¼Œé¿å…é‡å¤ç¼–å†™ã€‚
	4.	é€‚ç”¨äºå¸¦å‚æ•°çš„å‡½æ•°ï¼Œä½¿ç”¨ *args, **kwargs æ¥é€‚é…ä¸åŒçš„å‡½æ•°ã€‚
	5.	ä½¿ç”¨ @wraps(func) ä¿æŒåŸå‡½æ•°çš„ä¿¡æ¯ï¼ˆå¦‚ __name__ã€__doc__ï¼‰ã€‚
	6.	æ”¯æŒå¤šä¸ªè£…é¥°å™¨å åŠ ï¼Œæ‰§è¡Œé¡ºåºä»ä¸Šåˆ°ä¸‹ã€‚

â¸»

âœ… è£…é¥°å™¨çš„åº”ç”¨åœºæ™¯
	â€¢	æ—¥å¿—è®°å½•ï¼ˆLoggingï¼‰ğŸ“œ
	â€¢	æƒé™æ§åˆ¶ï¼ˆAuthenticationï¼‰ğŸ”’
	â€¢	æ€§èƒ½åˆ†æï¼ˆPerformance Monitoringï¼‰â³
	â€¢	ç¼“å­˜æœºåˆ¶ï¼ˆCachingï¼‰ğŸ—„ï¸
	â€¢	è¾“å…¥å‚æ•°éªŒè¯ï¼ˆValidationï¼‰âœ…


