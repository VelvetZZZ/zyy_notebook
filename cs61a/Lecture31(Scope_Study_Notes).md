# Scheme & ç¼–ç¨‹è¯­è¨€ä½œç”¨åŸŸå­¦ä¹ ç¬”è®°ï¼šLexical Scope ä¸ Dynamic Scope

---

## ğŸŒŸ ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸï¼ˆScopeï¼‰ï¼Ÿ

ä½œç”¨åŸŸæ˜¯æŒ‡ï¼š**ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚ä½•æŸ¥æ‰¾å˜é‡ç»‘å®šï¼ˆå˜é‡çš„å€¼ï¼‰çš„ä½ç½®**ã€‚

---

## ğŸ“˜ 1. Lexical Scopeï¼ˆè¯æ³•ä½œç”¨åŸŸï¼‰

### âœ… å®šä¹‰ï¼š
å˜é‡åœ¨å‡½æ•° **å®šä¹‰æ—¶** æ‰€åœ¨çš„ç¯å¢ƒä¸­æŸ¥æ‰¾ã€‚è¿™ç§ä½œç”¨åŸŸè§„åˆ™åˆç§°ä¸º *static scope*ã€‚

### ğŸ§  æŸ¥æ‰¾è·¯å¾„ï¼š
1. å½“å‰å‡½æ•°ä½“ä¸­
2. å‡½æ•°å®šä¹‰æ—¶çš„ç¯å¢ƒ
3. ä¸€ç›´å‘ä¸Šç›´åˆ°å…¨å±€ç¯å¢ƒ

### ğŸ’¡ ç‰¹ç‚¹ï¼š
- ä»£ç ç»“æ„å†³å®šå˜é‡æŸ¥æ‰¾è·¯å¾„
- è¡Œä¸ºå¯é¢„æµ‹ã€æ˜“è°ƒè¯•
- ç°ä»£è¯­è¨€ï¼ˆSchemeã€Pythonã€JavaScriptã€Javaï¼‰æ™®éä½¿ç”¨

### âœ… ç¤ºä¾‹ï¼š

```scheme
(define x 5)
(define (foo) x)
(define (bar) (let ((x 10)) (foo)))
(bar) ; => 5
```

å³ä½¿ `foo` åœ¨ `bar` ä¸­è¢«è°ƒç”¨ï¼Œä½†å®ƒå®šä¹‰æ—¶çœ‹åˆ°çš„ `x` æ˜¯å…¨å±€çš„ `5`ã€‚

---

## ğŸ“• 2. Dynamic Scopeï¼ˆåŠ¨æ€ä½œç”¨åŸŸï¼‰

### âœ… å®šä¹‰ï¼š
å˜é‡åœ¨å‡½æ•° **è°ƒç”¨æ—¶** æ‰€åœ¨çš„ç¯å¢ƒä¸­æŸ¥æ‰¾ã€‚

### ğŸ§  æŸ¥æ‰¾è·¯å¾„ï¼š
1. å‡½æ•°è°ƒç”¨è€…çš„ç¯å¢ƒï¼ˆå³è°ƒç”¨æ—¶çš„ä¸Šä¸‹æ–‡ï¼‰
2. å†å¾€ä¸ŠæŸ¥è°ƒç”¨æ ˆä¸­çš„ä¸Šä¸€å±‚ç¯å¢ƒ

### ğŸ’¡ ç‰¹ç‚¹ï¼š
- è°ƒç”¨ä½ç½®å†³å®šæŸ¥æ‰¾è·¯å¾„
- è¡Œä¸ºä¸æ˜“é¢„æµ‹ï¼Œè°ƒè¯•å›°éš¾
- å°‘æ•°è¯­è¨€ä½¿ç”¨ï¼ˆæ—©æœŸ Lispã€Emacs Lispã€bashï¼‰

### âœ… ç¤ºä¾‹ï¼š

```scheme
(define f (lambda (x) (+ x y)))
(define g (lambda (x y) (f (+ x x))))
(g 3 7) ; => 13 ï¼ˆåœ¨ dynamic scope ä¸‹ï¼‰
```

åœ¨ `f` ä¸­ä½¿ç”¨äº† `y`ï¼Œè™½ç„¶å®šä¹‰æ—¶çœ‹ä¸åˆ° `y`ï¼Œä½†è°ƒç”¨æ—¶ `g` æœ‰ `y=7`ï¼Œæ‰€ä»¥æˆåŠŸæ‰§è¡Œã€‚

---

## ğŸ§ª ä¸¤ç§ä½œç”¨åŸŸç»“æœå¯¹æ¯”ï¼š

ä»£ç ï¼š

```scheme
(define f (lambda (x) (+ x y)))
(define g (lambda (x y) (f (+ x x))))
(g 3 7)
```

| Scope ç±»å‹       | æŸ¥æ‰¾è§„åˆ™               | æ‰§è¡Œç»“æœ        |
|------------------|------------------------|------------------|
| Lexical Scope    | f çš„ parent æ˜¯å®šä¹‰ç¯å¢ƒ | âŒ æŠ¥é”™ï¼šæ‰¾ä¸åˆ° y |
| Dynamic Scope    | f çš„ parent æ˜¯è°ƒç”¨ç¯å¢ƒ g çš„ Frame | âœ… è¾“å‡º 13 |

---

## âš™ï¸ æ˜¯å¦å¯ä»¥ä¸¤ç§ä½œç”¨åŸŸå¹¶å­˜ï¼Ÿ

- âœ… ç†è®ºä¸Šå¯ä»¥ï¼ˆå¯ä»¥åœ¨è§£é‡Šå™¨ä¸­å®ç°ï¼‰
- âš ï¸ å®é™…ä¸Šå¾ˆå°‘è¿™æ ·åšï¼Œå®¹æ˜“å¼•å‘æ··ä¹±
- Emacs Lisp æ”¯æŒ dynamic scopeï¼Œä½†å¯é€šè¿‡è®¾ç½®ä½¿ç”¨ lexical scope

---

## ğŸ§± ç”¨ Python å®ç°ä½œç”¨åŸŸæ¨¡æ‹Ÿ

ä½ å¯ä»¥è‡ªå·±ç”¨ Python å®ç°ä½œç”¨åŸŸè§„åˆ™ï¼š

```python
class Frame:
    def __init__(self, parent):
        self.bindings = {}
        self.parent = parent

    def define(self, name, val):
        self.bindings[name] = val

    def lookup(self, name):
        if name in self.bindings:
            return self.bindings[name]
        elif self.parent:
            return self.parent.lookup(name)
        else:
            raise NameError("Unbound variable: " + name)
```

æƒ³è¦åŠ¨æ€ä½œç”¨åŸŸï¼Ÿè°ƒç”¨å‡½æ•°æ—¶å°† `caller_env` è®¾ä¸º parent å³å¯ï¼

---

## ğŸ§  æ€»ç»“ï¼šLexical vs Dynamic Scope

| é¡¹ç›® | Lexical Scope | Dynamic Scope |
|------|----------------|----------------|
| æŸ¥å˜é‡èµ·ç‚¹ | å‡½æ•°å®šä¹‰æ—¶çš„ç¯å¢ƒ | å‡½æ•°è°ƒç”¨æ—¶çš„ç¯å¢ƒ |
| æ˜“è¯»æ€§ | âœ… å¥½ | âŒ å·® |
| å¯ç»´æŠ¤æ€§ | âœ… é«˜ | âŒ ä½ |
| åº”ç”¨è¯­è¨€ | Pythonã€Schemeã€JS | Bashã€Emacs Lispï¼ˆé»˜è®¤ï¼‰ |
| ç¤ºä¾‹ç»“æœ | æŠ¥é”™æˆ–æ­£å¸¸ï¼Œå›ºå®šè¡Œä¸º | è¡Œä¸ºä¾èµ–ä¸Šä¸‹æ–‡è°ƒç”¨ |

---

## ğŸ“ ç»“è¯­

ç†è§£ä½œç”¨åŸŸæ˜¯æŒæ¡ç¼–ç¨‹è¯­è¨€å’Œè§£é‡Šå™¨è®¾è®¡çš„æ ¸å¿ƒã€‚ä½ å¯ä»¥ç”¨ Python/Scheme å®Œå…¨â€œäººå·¥â€å®ç°ä½œç”¨åŸŸç³»ç»Ÿï¼Œç”šè‡³è‡ªç”±åˆ‡æ¢è¯æ³•å’ŒåŠ¨æ€ä½œç”¨åŸŸï¼
